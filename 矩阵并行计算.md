# 矩阵并行计算
## 记号和假定
* 假设有***p***个处理器，每个处理器上运行一个进程
* $P_j$表示第***j***个处理器，$P_{myid}$表示当前的处理器
* **send(x,j)** 表示在 $P_{myid}$ 中把数据块***x***发送到 $P_j$ 进程
*  **recv(x,j)** 表示从 $P_j$ 进程接受数据块***x***
*  ***i*** **mod** ***p***表示 ***i*** 对 ***p*** 取模运算
  

## 矩阵向量乘积

$$y=Ax , A\in R^{m\times n}$$

### 串行算法
#### 实现方法1：i-j循环

```C++
//相关变量已声明定义
for(int i=0;i < m;i++)
{
    y[i]=0;
    for(int j=0;j < n;j++)
    {
        y[i]=y[i]+A[i][j]*x[j];
    }
}

```
#### 实现方法2：j-i循环

```C++
//相关变量已声明定义（其中列阵y元素已初始化为0）
for(int i=0;i < m;i++)
{
    for(int j=0;j < n;j++)
    {
        y[i]=y[i]+A[i][j]*x[j];
    }
}

```
### 并行算法
矩阵划分方法：
* 按行划分
* 按列划分
#### 按行划分
将矩阵**A**按行划分成如下的<font color=#FF0000> 行块子矩阵</font>  
$$A=[A_0^T,A_1^T,...,A_{p-1}^T]^T$$
则:
$$Ax=[(A_0x)^T,(A_1x)^T,...,(A_{p-1})^T]^T$$
将$A_i$存放在$P_i$中，每个节点计算$A_ix$，最后调用**MPI_GATHER**或**MPI_GATHERV**即可。

#### 按列划分
将矩阵**A**按列划分，并对**x**也做相应的划分。
$$A=[A_0^T,A_1^T,...,A_{p-1}^T]^T$$
$$x=(x_0^T,x_1^T,...,x_{p-1}^T)^T$$
则:
$$Ax=\sum_{i=0}^{p-1}A_ix_i^T$$
将$A_i$和$x_i$存放在$P_i$中，每个节点计算$A_ix_i^T$，最后调用**MPI_REDUCE**或**MPI_ALLREDUCE**即可。

## 矩阵矩阵乘积
$$C=A*B  ,A\in R^{m\times l},B\in R^{l\times n}$$
### 串行算法
#### 实现方法1：i-j-k循环
```C++
//相关变量已声明定义
for(int i=0;i < m;i++)
{
    for(int j=0;j < l;j++)
    {
    y[i]=0;
    for(int k=0;k < n;k++)
    {
        y[i]=y[i]+A[i][j]*x[j];
    }
    }

```